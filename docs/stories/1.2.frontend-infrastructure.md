# Story 1.2: Frontend Infrastructure

## Status
Draft

## Story
**As a** developer,
**I want** to set up a complete frontend build infrastructure with Vite, Tailwind CSS, component library, and PWA capabilities,
**so that** the mobile-first industrial maintenance application can be developed efficiently with optimal performance and offline capabilities.

## Acceptance Criteria
1. Vite configured with PWA plugin, TypeScript, and optimization settings
2. Tailwind CSS set up with custom industrial design system tokens
3. Headless UI component library initialized with base components
4. PWA manifest created and service worker configured for offline capabilities
5. Build pipeline configured for Vercel deployment with automatic optimization
6. Development server set up with hot module replacement and proper proxy configuration
7. Bundle size analysis and performance budgets established

## Tasks / Subtasks
- [ ] Configure Vite build system with all required plugins (AC: 1)
  - [ ] Set up vite.config.ts with TypeScript support
  - [ ] Configure PWA plugin with service worker generation
  - [ ] Set up path aliases for clean imports
  - [ ] Configure development server with API proxy
  - [ ] Add bundle analysis and optimization plugins
- [ ] Set up Tailwind CSS with industrial design system (AC: 2)
  - [ ] Configure tailwind.config.js with custom theme
  - [ ] Create industrial color palette (high visibility, safety colors)
  - [ ] Define typography scales for mobile readability
  - [ ] Set up responsive breakpoints for tablet/mobile/desktop
  - [ ] Create utility classes for common industrial UI patterns
- [ ] Initialize component library with Headless UI (AC: 3)
  - [ ] Install Tailwind CSS first (required dependency for Headless UI styling)
  - [ ] Install and configure Headless UI components
  - [ ] Set up @tailwindcss/forms plugin for Headless UI form styling
  - [ ] Create base component templates (Button, Input, Card, Badge)
  - [ ] Set up component documentation structure
  - [ ] Create industrial-specific components (StatusIndicator, PriorityBadge)
  - [ ] Establish component naming and file organization standards
- [ ] Configure PWA capabilities (AC: 4)
  - [ ] Create PWA manifest.json with app metadata
  - [ ] Configure service worker for offline caching
  - [ ] Set up app installation prompts
  - [ ] Configure push notification capabilities
  - [ ] Test PWA functionality on mobile devices
- [ ] Set up production build pipeline (AC: 5)
  - [ ] Configure Vercel deployment settings
  - [ ] Set up environment-specific builds
  - [ ] Configure automatic optimization and code splitting
  - [ ] Set up CDN distribution and caching headers
- [ ] Configure development environment (AC: 6)
  - [ ] Set up HMR with proper state preservation
  - [ ] Configure API proxy for development
  - [ ] Set up error overlay and development tools
  - [ ] Configure source maps for debugging
- [ ] Establish performance monitoring (AC: 7)
  - [ ] Set up bundle size analyzer
  - [ ] Configure Core Web Vitals monitoring
  - [ ] Establish performance budgets
  - [ ] Set up build size alerts

## Dev Notes

### Vite Configuration Key Points
- **Build Tool:** Vite 5.0+ for lightning-fast HMR and optimized builds
- **PWA Plugin:** Vite PWA plugin for service worker generation
- **TypeScript:** Strict mode with path aliases (@/ for src/)
- **Dev Server:** Proxy configuration for API calls to localhost:3001
- **Bundle Optimization:** Automatic code splitting and tree shaking

### Tailwind Industrial Design System
```css
/* Industrial Color Palette */
:root {
  --color-primary: #2563eb;     /* Blue for primary actions */
  --color-success: #16a34a;     /* Green for completion */
  --color-warning: #f59e0b;     /* Orange for warnings */
  --color-critical: #dc2626;    /* Red for critical priorities */
  --color-surface: #f8fafc;     /* Light gray for backgrounds */
  --color-text: #1e293b;        /* Dark gray for text */
}
```

### Mobile-First Breakpoints
- **Mobile:** 320px - 767px (primary target)
- **Tablet:** 768px - 1023px (supervisor features)
- **Desktop:** 1024px+ (admin features)

### Component Library Structure
```
src/components/
├── ui/                    # Base UI components
│   ├── Button.tsx
│   ├── Input.tsx
│   ├── Card.tsx
│   └── Badge.tsx
├── forms/                 # Form components
│   ├── WorkOrderForm.tsx
│   └── EquipmentForm.tsx
├── layout/                # Layout components
│   ├── Header.tsx
│   ├── TabBar.tsx
│   └── Sidebar.tsx
└── industrial/            # Industry-specific components
    ├── StatusIndicator.tsx
    ├── PriorityBadge.tsx
    └── MaintenanceTimer.tsx
```

### PWA Configuration
- **Manifest:** App name, icons, theme colors
- **Service Worker:** Cache static assets, API responses, offline fallbacks
- **Installation Criteria:** Meets PWA installability standards
- **Offline Support:** Cached work orders, basic functionality offline

### Service Worker Implementation Details
**Service Worker Configuration:**
```javascript
// vite.config.ts PWA plugin configuration
import { VitePWA } from 'vite-plugin-pwa'

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg}'],
        runtimeCaching: [
          {
            urlPattern: /^https:\/\/api\.supabase\.io\/.*/i,
            handler: 'NetworkFirst',
            options: {
              cacheName: 'api-cache',
              expiration: {
                maxEntries: 100,
                maxAgeSeconds: 60 * 60 * 24 // 24 hours
              }
            }
          }
        ]
      },
      manifest: {
        name: 'GMAOapp',
        short_name: 'GMAO',
        description: 'Industrial Maintenance Work Order Management',
        theme_color: '#2563eb',
        background_color: '#ffffff',
        display: 'standalone',
        icons: [
          {
            src: 'icons/icon-192x192.png',
            sizes: '192x192',
            type: 'image/png'
          },
          {
            src: 'icons/icon-512x512.png',
            sizes: '512x512',
            type: 'image/png'
          }
        ]
      }
    })
  ]
})
```

**Offline Strategy:**
- **Static Assets:** Cache all JS, CSS, images on install
- **API Responses:** Network-first strategy with 24-hour cache
- **Critical Data:** Work orders and equipment cached locally
- **Fallback Pages:** Offline fallback page for network failures

### Performance Targets
- **Initial Load:** <500ms on 3G network
- **Bundle Size:** <1MB total, <500KB for subsequent loads
- **Time to Interactive:** <1.5 seconds
- **Core Web Vitals:** LCP <2.5s, FID <100ms, CLS <0.1

### Bundle Size Analysis Configuration
**Vite Bundle Analyzer Setup:**
```javascript
// vite.config.ts
import { defineConfig } from 'vite'
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    visualizer({
      filename: 'dist/stats.html',
      open: true,
      gzipSize: true,
      brotliSize: true
    })
  ]
})
```

**Performance Budget Examples:**
- **React + Core Libraries:** <300KB gzipped
- **Tailwind CSS:** <50KB purged
- **Supabase Client:** <100KB gzipped
- **Headless UI:** <80KB tree-shaken
- **Application Code:** <200KB gzipped
- **Total Initial Bundle:** <730KB gzipped

**Performance Monitoring:**
```javascript
// Performance monitoring setup
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals'

function sendToAnalytics(metric) {
  // Send to Vercel Analytics or custom endpoint
  console.log('Performance metric:', metric.name, metric.value)
}

getCLS(sendToAnalytics)
getFID(sendToAnalytics)
getFCP(sendToAnalytics)
getLCP(sendToAnalytics)
getTTFB(sendToAnalytics)
```

### Accessibility Requirements (WCAG AA)
- **Touch Targets:** Minimum 48x48px for industrial use
- **Color Contrast:** 4.5:1 minimum contrast ratio
- **Text Size:** Minimum 14px body, 16px for critical information
- **Screen Reader:** Proper semantic HTML and ARIA labels

### Development Workflow
```bash
# Development
pnpm --filter web dev          # Start dev server with HMR
pnpm --filter web build        # Production build
pnpm --filter web preview      # Preview production build
pnpm --filter web analyze      # Bundle analysis

# PWA Testing
pnpm --filter web pwadev       # PWA development mode
```

### Environment Variables
```bash
# Frontend (.env.local)
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
NEXT_PUBLIC_API_URL=http://localhost:3001
NEXT_PUBLIC_APP_NAME=GMAOapp
```


### Testing
- **Framework:** Vitest for unit tests, Playwright for E2E
- **Test Location:** `src/__tests__/` directory alongside components
- **Testing Standards:** Component tests for all UI components
- **Testing Integration:** Testing framework setup will be completed in Story 1.4 (Testing Infrastructure)
- **Visual Testing:** Screenshots for responsive design verification

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-07 | v1.0 | Initial story creation | Sarah (PO) |
| 2025-11-10 | v1.3 | Removed HTML-to-React conversion tool from story scope | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*